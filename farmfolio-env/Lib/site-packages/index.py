from flask import Flask,render_template,request,redirect,url_for
from re import A
from app import app,db
import csv
import threading
from funcion import *
import time
import threading
from mapa_basededatos import usuario

@app.route('/')
def inicio():
    return render_template('index.html')
     
@app.route('/diario', methods=['GET', 'POST'])
def diario():
    vol_nacional=("https://docs.google.com/spreadsheets/d/e/2PACX-1vQU_8lE-Xq1nbdZgBKE-7ciiTJvldN00Tb6X_tRNJRAJOiL3hqph5jshQbIs9DH1Q/pub?output=csv")
    vol_export=("https://docs.google.com/spreadsheets/d/e/2PACX-1vQFzbN1RJSYKIZ1_1Cy6pDk54waNHtZoenjT74e5PbSWU1yuvdYd4ssxJ6uC1MD_tXh72jix_fxqM4Q/pub?gid=1744910857&single=true&output=csv")
   
    while True:
        aguacate,naranja,limon,coco,limone,semana=traer_info(vol_nacional,vol_export)
        total=aguacate+naranja+limon+coco
        totalgeneral=round(total+limone, 2)
        
        time.sleep(1)
        return render_template('farmDiario.html', aguacate = aguacate,naranja= naranja
                           ,limon = limon,coco=coco,total=total,limone=limone, totalgeneral=totalgeneral,semana=semana)
  
# redireciono con el boton a la pgina html con la funcion registrarse
@app.route('/logearse', methods=['POST'])
def logearse():
    
    # SI EL METODO ES POST ENTONCE:
    if request.method =="POST": 
        # trae nombre desde registrse.html y lo mete en la variabel
         log_email=request.form["email"]
         log_password=request.form["password"]
         
         print(log_email)
         print(log_password)
         
         # recorrer todo e guardar en val_email
         val_email=usuario.query.all()
         # recorrer cada usuario
         for e in val_email:
             # si el correo es igual al digitado ingresa
             if e.Correo == log_email:
                 print("correo registrado")
                 if e.Contrasenia == log_password:
                     mensaje=e.Nombre
                     print(e.Nombre)
                     return redirect(url_for('diario'))
                 
                 else :
                     print("contrase√±a no coincide")
             else:
                 print("correo no registrado")
                 
    return render_template('index.html')           

  
        
 # se define el puerto de salida
if __name__ == "__main__":
    app.run(debug=True, port=5000)


